{% extends "layout.html" %} {% block content %}
<style>
  .form-check {
    display: flex;
    align-items: flex-end;
    min-height: 1.3125rem;
    padding-left: 1.5em;
    margin-bottom: 0.125rem;
  }
  .spin-icon {
    animation: spin 1s linear infinite;
  }
  @keyframes spin {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }
</style>
<section
  class="py-4 bg-light border-bottom"
  id="project-metadata"
  data-project-id="{{ project_id }}"
  data-project-name="{{ project_name }}">
  <div class="container">
    <div
      class="d-flex flex-column flex-lg-row align-items-lg-center justify-content-between gap-3">
      <div>
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb mb-2">
            <li class="breadcrumb-item">
              <a href="/"
                ><i class="bi bi-house me-1"></i>{{ t('nav.home') }}</a
              >
            </li>
            <li class="breadcrumb-item active" aria-current="page">
              {{ t('manage.breadcrumb.project_management') }}
            </li>
          </ol>
        </nav>
      </div>
      <div class="d-flex flex-wrap gap-2">
        <a
          class="btn btn-secondary"
          href="?tab=overview"
          data-tab-link="overview">
          {{ t('manage.tabs.overview') }}
        </a>
        <button
          class="btn btn-primary"
          id="start-translate-btn"
          data-tab-link="translate">
          <i class="bi bi-robot me-1"></i>{{ t('manage.tabs.ai_translation') }}
        </button>
        <button
          class="btn btn-warning"
          id="protected-terms-btn"
          data-tab-link="protected">
          <i class="bi bi-shield-check me-1"></i>{{ t('manage.tabs.protection')
          }}
        </button>
        <button
          class="btn btn-success"
          id="manual-translate-btn"
          data-tab-link="manual">
          <i class="bi bi-pencil-square me-1"></i>{{ t('manage.tabs.manual') }}
        </button>
      </div>
    </div>
  </div>
</section>

<!-- Manual Translation: Select target languages modal -->
<div
  class="modal fade"
  id="manualLanguageModal"
  tabindex="-1"
  aria-labelledby="manualLanguageModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="manualLanguageModalLabel">
          {{ t('manage.manual.select_languages_title') }}
        </h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div id="manual-language-list" class="d-grid gap-2"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          {{ t('common.cancel') }}
        </button>
        <button
          type="button"
          class="btn btn-primary"
          id="manual-language-confirm-btn">
          {{ t('manage.manual.add_to_list') }}
        </button>
      </div>
    </div>
  </div>
</div>

<section class="py-4">
  <div class="container">
    <div class="row g-3" id="overview-stat-cards">
      <div class="col-12">
        <div>
          <h1 class="h4 mb-1" id="project-title">
            {{ t('manage.overview.title') }}
          </h1>
          <p class="text-muted small mb-1" id="project-subtitle">
            {{ t('manage.overview.loading_metadata') }}
          </p>
          <p class="text-muted small mb-0" id="project-sync-status">
            <i class="bi bi-arrow-repeat me-1 spin-icon" id="sync-spinner"></i>
            <span id="sync-status-text">{{ t('manage.sync.syncing') }}</span>
            <span id="last-synced-time" class="d-none"></span>
            <a href="#" id="reload-source-link" class="ms-2 d-none"
              >{{ t('manage.sync.reload_source') }}</a
            >
          </p>
        </div>
      </div>
      <div class="col-12 col-md-6 col-xl-3">
        <div class="card shadow-sm border-0 h-100">
          <div class="card-body">
            <p class="text-muted text-uppercase small mb-1">
              {{ t('manage.overview.source_language') }}
            </p>
            <h5 class="fw-semibold mb-1" id="source-language-value">-</h5>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6 col-xl-3">
        <div class="card shadow-sm border-0 h-100">
          <div class="card-body">
            <p class="text-muted text-uppercase small mb-1">
              {{ t('manage.overview.source_keys') }}
            </p>
            <h5 class="fw-semibold mb-1" id="source-keys-count">-</h5>
            <p class="mb-0 small text-muted">
              {{ t('manage.overview.source_keys_desc') }}
            </p>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6 col-xl-3">
        <div class="card shadow-sm border-0 h-100">
          <div class="card-body">
            <p class="text-muted text-uppercase small mb-1">
              {{ t('manage.overview.pages') }}
            </p>
            <h5 class="fw-semibold mb-1" id="page-count">-</h5>
            <p class="mb-0 small text-muted">
              {{ t('manage.overview.pages_desc') }}
            </p>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6 col-xl-3">
        <div class="card shadow-sm border-0 h-100">
          <div class="card-body">
            <p class="text-muted text-uppercase small mb-1">
              {{ t('manage.overview.target_languages') }}
            </p>
            <h5 class="fw-semibold mb-1" id="target-language-count">-</h5>
            <p class="mb-0 small text-muted" id="target-language-summary">-</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="pb-5">
  <div class="container">
    <div
      class="tab-content border rounded-bottom shadow-sm bg-white"
      id="manageTabContent">
      <div
        class="tab-pane fade show active p-4"
        id="overview-pane"
        role="tabpanel"
        aria-labelledby="overview-tab">
        <div class="row g-4">
          <div class="col-12 col-xl-6">
            <div class="card border-0 shadow-sm h-100">
              <div class="card-header bg-white border-0">
                <h5 class="card-title mb-0">
                  {{ t('manage.overview.language_progress.title') }}
                </h5>
                <p class="text-muted small mb-0">
                  {{ t('manage.overview.language_progress.description') }}
                </p>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table
                    class="table table-sm align-middle"
                    id="language-progress-table">
                    <thead>
                      <tr>
                        <th>
                          {{ t('manage.overview.language_progress.language') }}
                        </th>
                        <th class="text-center">
                          {{ t('manage.overview.language_progress.translated')
                          }}
                        </th>
                        <th class="text-center">
                          {{ t('manage.overview.language_progress.locked') }}
                        </th>
                        <th class="text-center">
                          {{ t('manage.overview.language_progress.missing') }}
                        </th>
                        <th class="text-end">
                          {{ t('manage.overview.language_progress.complete') }}
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td colspan="5" class="text-center text-muted py-4">
                          {{ t('manage.overview.language_progress.loading') }}
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12 col-xl-6">
            <div class="card border-0 shadow-sm h-100">
              <div class="card-header bg-white border-0">
                <h5 class="card-title mb-0">
                  {{ t('manage.overview.pages_table.title') }}
                </h5>
                <p class="text-muted small mb-0">
                  {{ t('manage.overview.pages_table.description') }}
                </p>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-sm align-middle" id="pages-table">
                    <thead>
                      <tr>
                        <th>{{ t('manage.overview.pages_table.page') }}</th>
                        <th class="text-end">
                          {{ t('manage.overview.pages_table.key_count') }}
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td colspan="2" class="text-center text-muted py-4">
                          {{ t('manage.overview.pages_table.loading') }}
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div
        class="tab-pane fade p-4"
        id="manual-pane"
        role="tabpanel"
        aria-labelledby="manual-tab">
        <div class="row g-4">
          <div class="col-12">
            <h4 class="mb-2">{{ t('manage.manual.title') }}</h4>
            <p class="text-muted small mb-4">
              {{ t('manage.manual.description') }}
            </p>
          </div>
          <div class="col-12">
            <div class="card border-0 shadow-sm">
              <div class="card-body">
                <div class="row g-3 align-items-end">
                  <div class="col-12">
                    <label class="form-label" for="manual-search-input"
                      >{{ t('manage.manual.search_label') }}</label
                    >
                    <input
                      type="search"
                      class="form-control"
                      id="manual-search-input"
                      placeholder="{{ t('manage.manual.search_placeholder') }}" />
                  </div>
                  <div class="col-12 col-md-6 col-lg-4">
                    <label class="form-label" for="manual-page-select"
                      >{{ t('manage.manual.page_label') }}</label
                    >
                    <select class="form-select" id="manual-page-select">
                      <option value="">
                        {{ t('manage.manual.all_pages') }}
                      </option>
                    </select>
                  </div>
                  <div class="col-12 col-md-6 col-lg-4 d-grid">
                    <button class="btn btn-primary" id="manual-search-btn">
                      {{ t('manage.manual.search_btn') }}
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="col-12">
            <div class="card border-0 shadow-sm">
              <div
                class="card-header bg-white border-0 d-flex flex-wrap gap-2 justify-content-between align-items-center">
                <h5 class="card-title mb-0">
                  {{ t('manage.manual.search_results.title') }}
                </h5>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table
                    class="table table-hover align-middle"
                    id="manual-key-results-table">
                    <thead>
                      <tr>
                        <th>{{ t('manage.manual.search_results.key') }}</th>
                        <th>{{ t('manage.manual.search_results.page') }}</th>
                        <th>
                          {{ t('manage.manual.search_results.source_text') }}
                        </th>
                        <th class="text-end">{{ t('common.actions') }}</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td colspan="4" class="text-center text-muted py-4">
                          {{ t('manage.manual.search_results.empty') }}
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>

          <div class="col-12">
            <div class="card border-0 shadow-sm">
              <div
                class="card-header bg-white border-0 d-flex flex-wrap gap-2 justify-content-between align-items-center">
                <h5 class="card-title mb-0">
                  {{ t('manage.manual.worklist.title') }}
                </h5>
                <div class="d-flex flex-wrap gap-2 align-items-center">
                  <div class="d-flex align-items-center gap-2">
                    <label class="form-label mb-0" for="manual-worklist-sort"
                      >{{ t('manage.manual.worklist.sort_by') }}</label
                    >
                    <select
                      class="form-select form-select-sm"
                      id="manual-worklist-sort"
                      style="width: 200px">
                      <option value="last_translated_at_desc">
                        {{ t('manage.manual.worklist.sort_update_newest') }}
                      </option>
                      <option value="last_translated_at_asc">
                        {{ t('manage.manual.worklist.sort_update_oldest') }}
                      </option>
                      <option value="key_path_asc">
                        {{ t('manage.manual.worklist.sort_key_az') }}
                      </option>
                      <option value="key_path_desc">
                        {{ t('manage.manual.worklist.sort_key_za') }}
                      </option>
                      <option value="source_text_asc">
                        {{ t('manage.manual.worklist.sort_source_az') }}
                      </option>
                      <option value="source_text_desc">
                        {{ t('manage.manual.worklist.sort_source_za') }}
                      </option>
                      <option value="language_asc">
                        {{ t('manage.manual.worklist.sort_lang_az') }}
                      </option>
                      <option value="language_desc">
                        {{ t('manage.manual.worklist.sort_lang_za') }}
                      </option>
                    </select>
                  </div>
                  <button
                    class="btn btn-outline-success btn-sm"
                    id="manual-save-selected-btn"
                    disabled>
                    <i class="bi bi-lock-fill me-1"></i>{{
                    t('manage.manual.worklist.save_lock') }}
                  </button>
                  <button
                    class="btn btn-outline-secondary btn-sm"
                    id="manual-unlock-selected-btn"
                    disabled>
                    <i class="bi bi-unlock me-1"></i>{{
                    t('manage.manual.worklist.unlock') }}
                  </button>
                </div>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table
                    class="table table-hover align-middle"
                    id="manual-worklist-table">
                    <thead>
                      <tr>
                        <th style="width: 3rem">
                          <input
                            class="form-check-input"
                            type="checkbox"
                            id="manual-worklist-select-all"
                            disabled />
                        </th>
                        <th>{{ t('manage.manual.worklist.source_text') }}</th>
                        <th style="width: 180px">
                          {{ t('manage.manual.worklist.target_language') }}
                        </th>
                        <th>{{ t('manage.manual.worklist.target_text') }}</th>
                        <th class="text-end" style="width: 120px">
                          {{ t('common.status') }}
                        </th>
                        <th class="text-end" style="width: 160px">
                          {{ t('common.actions') }}
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td colspan="6" class="text-center text-muted py-5">
                          {{ t('manage.manual.worklist.empty') }}
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div
        class="tab-pane fade p-4"
        id="protected-pane"
        role="tabpanel"
        aria-labelledby="protected-tab">
        <div class="row g-4">
          <div class="col-12">
            <div class="alert alert-warning d-flex align-items-start gap-3">
              <i class="bi bi-shield-lock-fill fs-4"></i>
              <div>
                <h5 class="alert-heading mb-1">
                  {{ t('manage.protected.title') }}
                </h5>
                <p class="mb-2 small">
                  {{ t('manage.protected.description') }}
                </p>
                <div class="form-check form-switch">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="protected-terms-enabled" />
                  <label class="form-check-label" for="protected-terms-enabled">
                    {{ t('manage.protected.enable_switch') }}
                  </label>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12">
            <div class="card border-0 shadow-sm">
              <div class="card-body">
                <h5 class="card-title">
                  {{ t('manage.protected.add_term.title') }}
                </h5>
                <p class="small text-muted">
                  {{ t('manage.protected.add_term.description') }}
                </p>
                <div class="row g-3">
                  <!-- Row 1: Term (left half) and Key Scopes (right half) -->
                  <div class="col-12 col-md-6">
                    <label class="form-label" for="protected-term-input"
                      >{{ t('manage.protected.add_term.term_label') }}</label
                    >
                    <textarea
                      class="form-control"
                      id="protected-term-input"
                      rows="2"></textarea>
                    <div class="form-text">
                      {{ t('manage.protected.add_term.term_help') }}
                    </div>
                  </div>
                  <div class="col-12 col-md-6">
                    <label class="form-label" for="protected-key-scopes-input"
                      >{{ t('manage.protected.add_term.key_scopes_label')
                      }}</label
                    >
                    <div class="input-group">
                      <textarea
                        class="form-control"
                        id="protected-key-scopes-input"
                        rows="2"
                        placeholder="{{ t('manage.protected.add_term.key_scopes_placeholder') }}"
                        readonly></textarea>
                      <button
                        class="btn btn-secondary"
                        type="button"
                        id="protected-add-key-btn">
                        <i class="bi bi-plus-circle me-1"></i>{{
                        t('manage.protected.add_term.add_key_btn') }}
                      </button>
                    </div>
                    <div class="form-text">
                      {{ t('manage.protected.add_term.key_scopes_help') }}
                    </div>
                  </div>
                  <!-- Row 2: Category (radio buttons) -->
                  <div class="col-12">
                    <div class="d-flex flex-wrap gap-3 align-items-center">
                      <label class="form-label mb-0"
                        >{{ t('manage.protected.add_term.category_label')
                        }}</label
                      >
                      <div class="form-check">
                        <input
                          class="form-check-input"
                          type="radio"
                          name="protected-category"
                          id="protected-category-brand"
                          value="brand"
                          checked />
                        <label
                          class="form-check-label"
                          for="protected-category-brand">
                          {{ t('manage.protected.add_term.category_brand') }}
                        </label>
                      </div>
                      <div class="form-check">
                        <input
                          class="form-check-input"
                          type="radio"
                          name="protected-category"
                          id="protected-category-technical"
                          value="technical" />
                        <label
                          class="form-check-label"
                          for="protected-category-technical">
                          {{ t('manage.protected.add_term.category_technical')
                          }}
                        </label>
                      </div>
                      <div class="form-check">
                        <input
                          class="form-check-input"
                          type="radio"
                          name="protected-category"
                          id="protected-category-url"
                          value="url" />
                        <label
                          class="form-check-label"
                          for="protected-category-url">
                          {{ t('manage.protected.add_term.category_url') }}
                        </label>
                      </div>
                      <div class="form-check">
                        <input
                          class="form-check-input"
                          type="radio"
                          name="protected-category"
                          id="protected-category-code"
                          value="code" />
                        <label
                          class="form-check-label"
                          for="protected-category-code">
                          {{ t('manage.protected.add_term.category_code') }}
                        </label>
                      </div>
                    </div>
                  </div>
                  <!-- Row 3: Add Term button -->
                  <div class="col-12">
                    <button class="btn btn-primary" id="protected-add-btn">
                      <i class="bi bi-plus-circle me-1"></i>{{
                      t('manage.protected.add_term.add_btn') }}
                    </button>
                  </div>
                  <!-- Row 4: AI Analyze Suggestion -->
                  <div class="col-12">
                    <hr />
                    <h6 class="mb-3">
                      {{ t('manage.protected.analyze.title') }}
                    </h6>
                    <div class="d-flex flex-wrap gap-3 align-items-center">
                      <label
                        class="form-label mb-0"
                        for="protected-model-select"
                        >{{ t('manage.protected.analyze.model_label') }}</label
                      >
                      <select
                        class="form-select form-select-sm"
                        id="protected-model-select"
                        style="width: 250px">
                        <option value="">
                          {{ t('manage.protected.analyze.loading_models') }}
                        </option>
                      </select>
                      <button
                        class="btn btn-primary"
                        id="protected-analyze-btn">
                        <i class="bi bi-search-heart me-1"></i>{{
                        t('manage.protected.analyze.analyze_btn') }}
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12">
            <div class="card border-0 shadow-sm">
              <div
                class="card-header bg-white border-0 d-flex flex-wrap gap-2 justify-content-between align-items-center">
                <h5 class="card-title mb-0">
                  {{ t('manage.protected.list.title') }}
                </h5>
                <div class="d-flex flex-wrap gap-2">
                  <select
                    class="form-select form-select-sm"
                    id="protected-filter-category"
                    style="width: 200px">
                    <option value="">
                      {{ t('manage.protected.list.all_categories') }}
                    </option>
                    <option value="brand">
                      {{ t('manage.protected.add_term.category_brand') }}
                    </option>
                    <option value="technical">
                      {{ t('manage.protected.add_term.category_technical') }}
                    </option>
                    <option value="url">
                      {{ t('manage.protected.add_term.category_url') }}
                    </option>
                    <option value="code">
                      {{ t('manage.protected.add_term.category_code') }}
                    </option>
                  </select>
                  <select
                    class="form-select form-select-sm"
                    id="protected-sort-order"
                    style="width: 200px">
                    <option value="updated_at_desc">
                      {{ t('manage.protected.list.sort_update_newest') }}
                    </option>
                    <option value="updated_at_asc">
                      {{ t('manage.protected.list.sort_update_oldest') }}
                    </option>
                    <option value="term_asc">
                      {{ t('manage.protected.list.sort_term_az') }}
                    </option>
                    <option value="term_desc">
                      {{ t('manage.protected.list.sort_term_za') }}
                    </option>
                  </select>
                </div>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table
                    class="table table-hover align-middle"
                    id="protected-terms-table">
                    <thead>
                      <tr>
                        <th>{{ t('manage.protected.list.term') }}</th>
                        <th>{{ t('manage.protected.list.category') }}</th>
                        <th>{{ t('manage.protected.list.key_scopes') }}</th>
                        <th class="text-end">{{ t('common.actions') }}</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td colspan="4" class="text-center text-muted py-5">
                          {{ t('manage.protected.list.empty') }}
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <div class="card-footer bg-white border-0 small text-muted">
                {{ t('manage.protected.list.footer') }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Translate Tab Pane -->
      <div
        class="tab-pane fade p-4"
        id="translate-pane"
        role="tabpanel"
        aria-labelledby="translate-tab">
        <!-- Config Section (shown before translation starts) -->
        <div id="translate-config-section">
          <div class="row g-4">
            <!-- Left Column: AI Provider + Languages -->
            <div class="col-12 col-lg-6">
              <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                  <!-- AI Provider -->
                  <div class="mb-4">
                    <label class="form-label fw-semibold"
                      >{{ t('manage.translate.provider_label') }}</label
                    >
                    <select id="translate-provider" class="form-select">
                      <!-- Will be populated by JS -->
                    </select>
                    <div class="form-text">
                      {{ t('manage.translate.provider_help') }}
                    </div>
                    <div
                      id="translate-provider-error"
                      class="alert alert-warning mt-2 d-none">
                      {{ t('manage.translate.provider_error') }}
                      <a
                        href="#"
                        onclick="openSystemSettingsModal(); return false;"
                        >{{ t('manage.translate.provider_error_link') }}</a
                      >
                    </div>
                  </div>

                  <!-- Word Count per Batch -->
                  <div class="mb-4">
                    <label class="form-label fw-semibold"
                      >{{ t('manage.translate.words_per_batch_label') }}</label
                    >
                    <input
                      type="number"
                      id="translate-chunk-size-words"
                      class="form-control"
                      min="1"
                      max="1000"
                      value="300"
                      style="max-width: 200px" />
                    <div class="form-text">
                      {{ t('manage.translate.words_per_batch_help') }}
                    </div>
                  </div>

                  <!-- Target Languages -->
                  <div>
                    <label class="form-label fw-semibold"
                      >{{ t('manage.translate.target_languages_label') }}</label
                    >
                    <div class="form-check mb-2">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="translate-select-all" />
                      <label
                        class="form-check-label"
                        for="translate-select-all">
                        {{ t('common.select_all') }}
                      </label>
                    </div>
                    <div
                      class="table-responsive"
                      style="max-height: 300px; overflow-y: auto">
                      <table
                        class="table table-sm table-hover"
                        id="translate-languages-table">
                        <thead class="sticky-top bg-white">
                          <tr>
                            <th style="width: 40px"></th>
                            <th>{{ t('common.language') }}</th>
                            <th>{{ t('common.status') }}</th>
                            <th>
                              {{ t('manage.overview.language_progress.missing')
                              }}
                            </th>
                          </tr>
                        </thead>
                        <tbody id="translate-languages-tbody">
                          <!-- Will be populated by JS -->
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Right Column: Strategy + Options -->
            <div class="col-12 col-lg-6">
              <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                  <!-- Translation Strategy -->
                  <div class="mb-4">
                    <label class="form-label fw-semibold"
                      >{{ t('manage.translate.strategy_label') }}</label
                    >
                    <div class="form-check">
                      <input
                        class="form-check-input"
                        type="radio"
                        name="translate-strategy"
                        id="translate-strategy-missing"
                        value="missing_only"
                        checked />
                      <label
                        class="form-check-label"
                        for="translate-strategy-missing">
                        {{ t('manage.translate.strategy_missing_only') }}
                        <span class="badge bg-success"
                          >{{ t('manage.translate.strategy_missing_only_badge')
                          }}</span
                        >
                      </label>
                    </div>
                    <div class="form-check">
                      <input
                        class="form-check-input"
                        type="radio"
                        name="translate-strategy"
                        id="translate-strategy-ai"
                        value="missing_and_ai" />
                      <label
                        class="form-check-label"
                        for="translate-strategy-ai">
                        {{ t('manage.translate.strategy_missing_and_ai') }}
                      </label>
                    </div>
                    <div class="form-check">
                      <input
                        class="form-check-input"
                        type="radio"
                        name="translate-strategy"
                        id="translate-strategy-full"
                        value="full" />
                      <label
                        class="form-check-label"
                        for="translate-strategy-full">
                        {{ t('manage.translate.strategy_full') }}
                        <span class="badge bg-danger"
                          >{{ t('manage.translate.strategy_full_badge') }}</span
                        >
                      </label>
                    </div>
                    <div class="form-check">
                      <input
                        class="form-check-input"
                        type="radio"
                        name="translate-strategy"
                        id="translate-strategy-validate"
                        value="validate_only" />
                      <label
                        class="form-check-label"
                        for="translate-strategy-validate">
                        {{ t('manage.translate.strategy_validate') }}
                      </label>
                    </div>

                    <!-- Full mode warning with checkboxes -->
                    <div
                      id="translate-full-warning"
                      class="alert alert-danger mt-2 d-none">
                      <i class="bi bi-exclamation-triangle-fill me-2"></i>
                      {{ t('manage.translate.full_warning') }}
                      <div class="form-check mt-2">
                        <input
                          class="form-check-input"
                          type="checkbox"
                          id="translate-include-locked" />
                        <label
                          class="form-check-label"
                          for="translate-include-locked">
                          {{ t('manage.translate.include_locked') }}
                        </label>
                      </div>
                      <div class="form-check mt-1">
                        <input
                          class="form-check-input"
                          type="checkbox"
                          id="translate-confirm-understand" />
                        <label
                          class="form-check-label"
                          for="translate-confirm-understand">
                          {{ t('manage.translate.confirm_understand') }}
                        </label>
                      </div>
                    </div>
                  </div>

                  <!-- Advanced Settings (expanded by default) -->
                  <div class="mb-4">
                    <button
                      class="btn btn-sm btn-outline-secondary"
                      type="button"
                      data-bs-toggle="collapse"
                      data-bs-target="#translate-advanced-settings">
                      <i class="bi bi-gear me-1"></i> {{
                      t('manage.translate.advanced_settings') }}
                    </button>
                    <div
                      class="collapse show mt-2"
                      id="translate-advanced-settings">
                      <div class="card card-body bg-light">
                        <div class="form-check">
                          <input
                            class="form-check-input"
                            type="checkbox"
                            id="translate-generate-files"
                            checked />
                          <label
                            class="form-check-label"
                            for="translate-generate-files">
                            {{ t('manage.translate.generate_files') }}
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Start Button -->
          <div class="text-end mt-4">
            <button
              id="translate-start-btn"
              class="btn btn-primary btn-lg"
              disabled>
              <i class="bi bi-play-fill me-1"></i> {{
              t('manage.translate.start_btn') }}
            </button>
          </div>
        </div>

        <!-- Progress Section (shown during/after translation) -->
        <div id="translate-progress-section" class="d-none">
          <div class="card border-0 shadow-sm">
            <div
              class="card-header d-flex justify-content-between align-items-center">
              <h5 class="mb-0">
                <i class="bi bi-hourglass-split me-2"></i>{{
                t('manage.translate.progress.title') }}
              </h5>
              <button id="translate-cancel-btn" class="btn btn-danger btn-sm">
                <i class="bi bi-x-circle me-1"></i> {{
                t('manage.translate.progress.cancel_btn') }}
              </button>
            </div>
            <div class="card-body">
              <!-- Progress Bar -->
              <div class="mb-4">
                <div class="d-flex justify-content-between mb-1">
                  <span id="translate-progress-status"
                    >{{ t('manage.translate.progress.initializing') }}</span
                  >
                  <span id="translate-progress-percent">0%</span>
                </div>
                <div class="progress" style="height: 24px">
                  <div
                    id="translate-progress-bar"
                    class="progress-bar progress-bar-striped progress-bar-animated"
                    role="progressbar"
                    style="width: 0%"
                    aria-valuenow="0"
                    aria-valuemin="0"
                    aria-valuemax="100"></div>
                </div>
              </div>

              <!-- Briefing Log -->
              <div class="mb-4">
                <label class="form-label fw-semibold"
                  >{{ t('manage.translate.progress.briefing_log') }}</label
                >
                <div id="translate-briefing-log" class="briefing-log">
                  <!-- Briefing entries will be appended here -->
                </div>
              </div>

              <!-- Summary -->
              <div class="card bg-light">
                <div class="card-body">
                  <h6 class="card-title">
                    {{ t('manage.translate.progress.summary') }}
                  </h6>
                  <div class="row">
                    <div class="col-md-6">
                      <table class="table table-sm table-borderless mb-0">
                        <tr>
                          <td>
                            {{ t('manage.translate.progress.total_translated')
                            }}
                          </td>
                          <td
                            class="fw-semibold"
                            id="translate-summary-translated">
                            0
                          </td>
                        </tr>
                        <tr>
                          <td>
                            {{ t('manage.translate.progress.total_succeeded') }}
                          </td>
                          <td
                            class="fw-semibold text-success"
                            id="translate-summary-succeeded">
                            0
                          </td>
                        </tr>
                        <tr>
                          <td id="translate-summary-failed-label">
                            {{ t('manage.translate.progress.total_failed') }}
                          </td>
                          <td
                            class="fw-semibold text-danger"
                            id="translate-summary-failed">
                            0
                          </td>
                        </tr>
                      </table>
                    </div>
                    <div class="col-md-6">
                      <table class="table table-sm table-borderless mb-0">
                        <tr>
                          <td>
                            {{ t('manage.translate.progress.token_input') }}
                          </td>
                          <td
                            class="fw-semibold"
                            id="translate-summary-token-input">
                            0
                          </td>
                        </tr>
                        <tr>
                          <td>
                            {{ t('manage.translate.progress.token_output') }}
                          </td>
                          <td
                            class="fw-semibold"
                            id="translate-summary-token-output">
                            0
                          </td>
                        </tr>
                      </table>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Completion Actions -->
              <div
                id="translate-completion-actions"
                class="mt-4 text-center d-none">
                <button id="translate-back-btn" class="btn btn-secondary">
                  <i class="bi bi-arrow-left me-1"></i> {{
                  t('manage.translate.progress.back_btn') }}
                </button>
                <button id="translate-again-btn" class="btn btn-primary ms-2">
                  <i class="bi bi-arrow-repeat me-1"></i> {{
                  t('manage.translate.progress.translate_again_btn') }}
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Failed Translation Keys Modal -->
<div
  class="modal fade"
  id="failedTranslationKeysModal"
  tabindex="-1"
  aria-labelledby="failedTranslationKeysModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="failedTranslationKeysModalLabel">
          {{ t('manage.failed_keys_modal.title') }}
        </h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p class="text-muted mb-3">
          {{ t('manage.failed_keys_modal.description') }}
        </p>
        <div
          class="table-responsive"
          style="max-height: 60vh; overflow-y: auto">
          <table class="table table-sm table-hover">
            <thead class="table-light sticky-top">
              <tr>
                <th style="width: 5%">
                  <input
                    type="checkbox"
                    class="form-check-input"
                    id="failed-keys-select-all"
                    title="{{ t('common.select_all_title') }}" />
                </th>
                <th style="width: 25%">
                  {{ t('manage.failed_keys_modal.key_path') }}
                </th>
                <th style="width: 35%">
                  {{ t('manage.failed_keys_modal.source_text') }}
                </th>
                <th style="width: 15%">
                  {{ t('manage.failed_keys_modal.target_language') }}
                </th>
                <th style="width: 20%">
                  {{ t('manage.failed_keys_modal.error') }}
                </th>
              </tr>
            </thead>
            <tbody id="failed-translation-keys-tbody">
              <!-- Failed keys will be populated here -->
            </tbody>
          </table>
        </div>
      </div>
      <div class="modal-footer">
        <div class="d-flex flex-column gap-2 me-auto">
          <div class="d-flex align-items-center gap-2">
            <select
              class="form-select form-select-sm"
              id="failed-keys-protection-category"
              style="width: auto">
              <option value="">
                {{ t('manage.failed_keys_modal.select_category') }}
              </option>
              <option value="brand">
                {{ t('manage.protected.add_term.category_brand') }}
              </option>
              <option value="technical">
                {{ t('manage.protected.add_term.category_technical') }}
              </option>
              <option value="url">
                {{ t('manage.protected.add_term.category_url') }}
              </option>
              <option value="code">
                {{ t('manage.protected.add_term.category_code') }}
              </option>
            </select>
            <button
              type="button"
              class="btn btn-sm btn-primary"
              id="failed-keys-add-to-protected-btn"
              disabled>
              {{ t('manage.failed_keys_modal.add_to_protected') }}
            </button>
            <span class="text-muted">{{ t('common.or') }}</span>
            <button
              type="button"
              class="btn btn-sm btn-success"
              id="failed-keys-set-as-correct-btn"
              disabled>
              {{ t('manage.failed_keys_modal.set_as_correct') }}
            </button>
          </div>
        </div>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          {{ t('common.close') }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Suggestions Modal -->
<div
  class="modal fade"
  id="protectedSuggestionsModal"
  tabindex="-1"
  aria-labelledby="protectedSuggestionsModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="protectedSuggestionsModalLabel">
          {{ t('manage.protected.suggestions_modal.title') }}
        </h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p class="small text-muted">
          {{ t('manage.protected.suggestions_modal.description') }}
        </p>
        <div class="table-responsive">
          <table
            class="table table-hover align-middle"
            id="protected-suggestions-table">
            <thead>
              <tr>
                <th style="width: 3rem">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="protected-suggestions-select-all"
                    disabled />
                </th>
                <th>{{ t('manage.protected.suggestions_modal.term') }}</th>
                <th>{{ t('manage.protected.suggestions_modal.category') }}</th>
                <th>{{ t('manage.protected.suggestions_modal.matches') }}</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="4" class="text-center text-muted py-4">
                  {{ t('manage.protected.suggestions_modal.empty') }}
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          {{ t('common.cancel') }}
        </button>
        <button
          type="button"
          class="btn btn-primary"
          id="protected-suggestions-apply-btn"
          disabled>
          {{ t('manage.protected.suggestions_modal.apply_btn') }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Key Selection Modal -->
<div
  class="modal fade"
  id="protectedKeySelectionModal"
  tabindex="-1"
  aria-labelledby="protectedKeySelectionModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="protectedKeySelectionModalLabel">
          {{ t('manage.protected.key_selection_modal.title') }}
        </h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label class="form-label" for="protected-key-filter-input"
            >{{ t('manage.protected.key_selection_modal.filter_label') }}</label
          >
          <input
            type="text"
            class="form-control form-control-sm"
            id="protected-key-filter-input"
            placeholder="{{ t('manage.protected.key_selection_modal.filter_placeholder') }}" />
        </div>
        <!-- Selected Key Paths Display -->
        <div class="mb-3" id="selected-keys-display-container" style="display: none;">
          <label class="form-label small text-muted">
            {{ t('manage.protected.key_selection_modal.selected_keys_label') or 'Selected Key Paths' }}
          </label>
          <div id="selected-keys-display" class="d-flex flex-wrap gap-2 p-2 border rounded bg-light" style="min-height: 40px; max-height: 120px; overflow-y: auto;">
            <!-- Selected keys will be rendered here -->
          </div>
        </div>
        <div
          class="table-responsive"
          style="max-height: 500px; overflow-y: auto">
          <table
            class="table table-sm table-hover align-middle"
            id="protected-key-selection-table">
            <thead class="sticky-top bg-white">
              <tr>
                <th style="width: 3rem">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="protected-keys-select-all" />
                </th>
                <th>
                  {{ t('manage.protected.key_selection_modal.key_path') }}
                </th>
                <th>
                  {{ t('manage.protected.key_selection_modal.source_text') }}
                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="3" class="text-center text-muted py-4">
                  {{ t('manage.protected.key_selection_modal.loading') }}
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          {{ t('common.cancel') }}
        </button>
        <button
          type="button"
          class="btn btn-primary"
          id="protected-keys-add-btn">
          {{ t('manage.protected.key_selection_modal.add_btn') }}
        </button>
      </div>
    </div>
  </div>
</div>

{% endblock %} {% block scripts %}
<!-- Main framework must load first to establish LPM namespace -->
<script src="{{ url_for('static', filename='js/manage.js') }}"></script>
<!-- Feature modules load after main framework -->
<script src="{{ url_for('static', filename='js/manage-protected.js') }}"></script>
<script src="{{ url_for('static', filename='js/manage-manual.js') }}"></script>
<script src="{{ url_for('static', filename='js/manage-translate.js') }}"></script>
{% endblock %}
